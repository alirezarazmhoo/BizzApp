@model PagedList.Core.IPagedList<BizApp.Areas.Admin.Models.CategoryViewModel>

@{
    ViewData["Title"] = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

@section head
{
    <link href="~/lib/fontawesome-free/css/all.css" rel="stylesheet" />
    <link href="~/lib/fontawesome-iconpicker-master/dist/css/fontawesome-iconpicker.css" rel="stylesheet" />
}

<div class="header-secondary row gray-bg">
    <div class="col-lg-12">
        <div class="page-heading clearfix">
            <h1 class="page-title pull-left"> دسته بندی ها</h1><a class="btn btn-primary btn-sm btn-add openmodal" href="#" data-toggle="modal" data-target="#myModal">دسته جدید</a>
        </div>
        <!-- Breadcrumb -->
        <ol class="breadcrumb breadcrumb-2">
            <li><a href="#"><i class="fa fa-home"></i> خانه</a></li>
            <li class="active"><strong>دسته بندی ها</strong></li>
        </ol>

    </div>
</div>

<div class="row filter-wrapper visible-box" id="filter-box">
    <div class="col-lg-12">
        <div class="filter-header">
            <h3 class="title">جستجو</h3>
        </div>
        @using (Html.BeginForm("Index", "Categories", FormMethod.Get))
        {
            <div class="form-inline">
                <div class="form-group">
                    <input name="searchString" placeholder="نام دسته را وارد کنید" class="form-control">
                </div>
                <div class="form-group">
                    <button class="btn btn-default">جستجو</button>
                </div>
                <div class="form-group">
                    <a href="/admin/Categories/" class="btn btn-default">مشاهده همه</a>
                </div>
            </div>
        }
    </div>
</div>

<div class="main-content">
    <div class="row">
        <div class="col-lg-12 animatedParent animateOnce z-index-50">
            <div class="panel panel-default animated fadeInUp">
                <div class="panel-heading clearfix">
                    <h3 class="panel-title">دسته بندی ها</h3>
                    <ul class="panel-tool-options">
                        <li><a data-rel="collapse" href="#"><i class="icon-down-open"></i></a></li>
                    </ul>
                </div>
                <div class="panel-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-border table-hover dataTables-example">
                            <thead>
                                <tr>
                                    <th>
                                        ردیف
                                    </th>
                                    <th>
                                        نام
                                    </th>
                                    <th>
                                        تعداد زیردسته
                                    </th>
                                    <th>
                                        عملیات
                                    </th>
                                </tr>
                                @{ int rowNo = 0; }
                                @foreach (var item in Model)
                                {
                                    <tr>
                                        <td>
                                            @(++rowNo)
                                        </td>
                                        <td>
                                            @item.Name
                                        </td>
                                        <td>
                                            @item.ChildCount عدد
                                        </td>
                                        <td>
                                            <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#QuestionModal" onclick="AssignButtonClicked(this)" data-assigned-id="@item.CategoryId">حذف</button> |
                                            <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#EditModal" id="@item.CategoryId"> ویرایش</button> |

                                            @if (item.HasChild)
                                            {
                                                <a href="/admin/Categories/ShowSubCateogries?Id=@item.CategoryId" class="btn btn-flickr">مشاهده زیر دسته</a>
                                            }
                                            <button type="button" class="btn btn-bitbucket" data-toggle="modal" data-target="#SubcategoryModal" onclick="SubCategoryAssignButtonClicked(this)" data-assigned-id="@item.CategoryId"> ایجاد زیردسته</button> |
                                            @if (!item.HasChild)
                                            {
                                                <button type="button" class="btn btn-adn" id="@item.CategoryId">ثبت خصوصیات</button>
                                            }
                                        </td>
                                    </tr>
                                }
                        </table>
                    </div>
                    <div class="row">
                        <div class="col-sm-5">
                        </div>
                        <div class="col-sm-7">
                            <div class="dataTables_paginate paging_simple_numbers" id="example1_paginate">
                                <ul class="pagination">

                                    <li>
                                        <pager list="@Model" asp-controller="Categories" asp-action="Index" asp-area="admin" />
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>



            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="myModal" role="dialog" style="height:auto;overflow-y:visible">
	<div class="modal-dialog modal-sm" style="width:400px">
		<div class="modal-content">
			<div class="modal-header text-center">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">ثبت جدید</h4>
			</div>
			<div class="modal-body" style="height:auto">
				<form id="register">
					<input id="CategoryId" name="CategoryId" hidden />
					<div class="form-group" style="margin-right:5px">
						<label for="Name"> نام :</label>
						<input display="نام" id="Name" name="Name" placeholder="نام دسته بندی را وارد کنید" class="form-control" style="width:70%" required>
					</div>
					<div class="btn-group">
						<label for="Name"> آیکن</label>
						<button data-selected="graduation-cap" type="button" class="icp demo btn btn-default dropdown-toggle iconpicker-component form-control" data-toggle="dropdown">
							<i id="iconResult" class="fa fa-fw"></i> &nbsp;<b>˅</b>
							<span class=""></span>
						</button>
						<div class="dropdown-menu"></div>
					</div>
					<input name="Icon" id="Icon" value="" type="hidden">
					<div class="form-group">
						<label for="">ترتیب</label>
						<input type="number" class="form-control" name="Order" id="Order" />
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-danger" data-dismiss="modal">انصراف</button>
				<button type="button" class="btn btn-success" onclick="Save();">ثبت</button>
			</div>
		</div>
	</div>
</div>
<div class="modal fade" id="SubcategoryModal" role="dialog" style="height:auto;overflow-y:visible">
    <div class="modal-dialog modal-sm" style="width:400px">
        <div class="modal-content">
            <div class="modal-header text-center">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">ثبت زیر دسته</h4>
            </div>
            <div class="modal-body" style="height:auto">
                <form id="SubCategoryregister">
                    <input id="ParentCategoryId" name="ParentCategoryId" hidden />
                    <div class="form-group" style="margin-right:5px">
                        <label for="SubcategoryName"> نام :</label>
                        <input display="نام" id="SubcategoryName" name="SubcategoryName" placeholder="نام زیر دسته بندی را وارد کنید" class="form-control" style="width:70%" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">انصراف</button>
                <button type="button" class="btn btn-success" onclick="SubCategorySave();">ثبت</button>
            </div>
        </div>
    </div>
</div>
<div id="Error"></div>
<div id="Success"></div>
<div id="Question"></div>

@section scripts
{
	<script src="~/lib/fontawesome-iconpicker-master/dist/js/fontawesome-iconpicker.js"></script>
	<script type="text/javascript">
		// Notice how this gets configured before we load Font Awesome
		window.FontAwesomeConfig = { autoReplaceSvg: false }
	</script>
	<script src="~/lib/fontawesome-free/js/all.js"></script>

	<script>
		$(document).ready(function () {

		});
		window.onload = Load;
		function Load() {
			CreateAllModals();
			$(".openmodal").click(function () {
				clear('register', ["input"]);
			});
			$(".btn-warning").click(function () {
				EditAjax("/admin/Categories/GetById", this.id);
				var bodyStyle = document.body.style;
				bodyStyle.removeProperty('padding-right');
			});
		}
		function Save() {
			if (checkvalidity('register') === 0) {
				return;
			}
			else {
				$("#myModal").modal('toggle');

				// get icon
				// get selected icon
				var classList = $('#iconResult').attr('class').split(/\s+/);
				//console.log(classList);

				// get icon name
				var str = classList[1];
				var iconName = str.substring(3, str.length);
				// sample: var camera = window.FontAwesome.icon({ prefix: 'fas', iconName: 'camera' })
				// help: https://fontawesome.com/how-to-use/javascript-api/setup/getting-started
				var selectedIcon = window.FontAwesome.icon({ prefix: classList[0], iconName: iconName });

				//console.log(selectedIcon);

				// set icon in input
				if (selectedIcon != undefined)
					$("#Icon").attr('value', selectedIcon.icon[4]);
				else
					$("#Icon").attr('value', '');

				var Parameters = [{ id: "Name", htmlname: "Name", special: "" }, { id: "CategoryId", htmlname: "CategoryId", special: "" }, { id: "Icon", htmlname: "Icon", special: "" }, { id: "Order", htmlname: "Order", special: "" }];
				PostAjax('/admin/Categories/CreateOrUpdate', Parameters, "/admin/Categories/Index");
			}
		}
		function AssignButtonClicked(elem) {
			$('#CategoryId').val($(elem).data('assigned-id'));
		}

        function SubCategoryAssignButtonClicked(elem) {

            $('#ParentCategoryId').val($(elem).data('assigned-id'));

        }
        function Remove() {
            var Parameters = [{ id: "CategoryId", htmlname: "CategoryId", special: "" }];
            PostAjax('/admin/Categories/Remove', Parameters, "/admin/Categories/Index");
        }
        function SubCategorySave() {
            if (checkvalidity('SubCategoryregister') === 0) {
                return;
            }
            else {
                var Parameters = [{ id: "Name", htmlname: "SubcategoryName", special: "" }, { id: "ParentCategoryId", htmlname: "ParentCategoryId", special: "" }];
                PostAjax('/admin/Categories/CreateOrUpdate', Parameters, "/admin/Categories/Index");
            }
        }

        // Pack Icon input
        $('.dropdown-menu').iconpicker();
    </script>
}
